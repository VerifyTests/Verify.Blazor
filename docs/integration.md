<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/integration.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Integration testing using Verify.Playwright

[Verify.Playwright](https://github.com/VerifyTests/Verify.HeadlessBrowsers#playwright-usage) extends [Verify](https://github.com/VerifyTests/Verify) to allow verification of Web UIs using [Playwright for .NET](https://github.com/microsoft/playwright-sharp/).

This sample shows how to use Verify.Playwright to perform snapshot testing (html and image) of a running Blazor app.


## Fixture for shared state

The running instance of the Blazor app and the Playwright driver are expensive to instantiate and should be share between tests. This sample uses xunit, so a [ClassFixture](https://xunit.net/docs/shared-context.html#class-fixture) is used to share state.

<!-- snippet: PlaywrightFixture.cs -->
<a id='snippet-PlaywrightFixture.cs'></a>
```cs
using Microsoft.Playwright;

public class PlaywrightFixture :
    IAsyncLifetime
{
    IPlaywright? playwright;
    Process? process;
    IBrowser? browser;

    public IBrowser Browser
    {
        get => browser!;
    }

    public async Task InitializeAsync()
    {
        StartBlazorApp();
        playwright = await Playwright.CreateAsync();
        browser = await playwright.Chromium.LaunchAsync();
    }

    void StartBlazorApp()
    {
        var baseDirectory = AppDomain.CurrentDomain.BaseDirectory;
        var binPath = baseDirectory.Replace("Verify.Blazor.Tests", "BlazorApp");
        var projectDir = Path.GetFullPath(Path.Combine(binPath, "../../"));
        var startInfo = new ProcessStartInfo("dotnet", "run")
        {
            WorkingDirectory = projectDir
        };
        process = Process.Start(startInfo);
    }

    public async Task DisposeAsync()
    {
        if (browser != null)
        {
            await browser.DisposeAsync();
        }

        playwright?.Dispose();

        if (process != null)
        {
            process.Kill();
            process.Dispose();
        }
    }
}
```
<sup><a href='/src/Verify.Blazor.Tests/IntegrationTest/PlaywrightFixture.cs#L1-L49' title='Snippet source file'>snippet source</a> | <a href='#snippet-PlaywrightFixture.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Tests

Test can now verify the page state or the state of a specific element.

<!-- snippet: PlaywrightUsageTest.cs -->
<a id='snippet-PlaywrightUsageTest.cs'></a>
```cs
using Microsoft.Playwright;

[UsesVerify]
public class PlaywrightUsageTest :
    IClassFixture<PlaywrightFixture>
{
    IBrowser browser;

    public PlaywrightUsageTest(PlaywrightFixture fixture)
    {
        browser = fixture.Browser;
    }

    [Fact]
    public async Task PageUsage()
    {
        var page = await browser.NewPageAsync();
        var size = page.ViewportSize!;
        size.Height = 768;
        size.Width = 1024;
        await page.GotoAsync("http://localhost:5025");
        await page.WaitForSelectorAsync(".main");
        await Verify(page);
    }

    [Fact]
    public async Task ElementUsage()
    {
        var page = await browser.NewPageAsync();
        await page.GotoAsync("http://localhost:5025");
        await page.WaitForLoadStateAsync(LoadState.DOMContentLoaded);
        await page.WaitForSelectorAsync(".main");
        var element = await page.QuerySelectorAsync(".content");
        await Verify(element);
    }
}
```
<sup><a href='/src/Verify.Blazor.Tests/IntegrationTest/PlaywrightUsageTest.cs#L1-L36' title='Snippet source file'>snippet source</a> | <a href='#snippet-PlaywrightUsageTest.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Page results

<!-- snippet: PlaywrightUsageTest.PageUsage.00.verified.html -->
<a id='snippet-PlaywrightUsageTest.PageUsage.00.verified.html'></a>
```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BlazorApp</title>
    <base href="/">
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
  </head>
  <body>
    <app>
      <div class="sidebar">
        <div class="top-row pl-4 navbar navbar-dark">
          <a class="navbar-brand" href="">BlazorApp</a>
          <button class="navbar-toggler">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
        <div class="collapse">
          <ul class="nav flex-column">
            <li class="nav-item px-3">
              <a href="" class="nav-link active">
                <span class="oi oi-home" aria-hidden="true"></span>
                Home
              </a>
            </li>
            <li class="nav-item px-3">
              <a href="counter" class="nav-link">
                <span class="oi oi-plus" aria-hidden="true"></span>
                Counter
              </a>
            </li>
            <li class="nav-item px-3">
              <a href="fetchdata" class="nav-link">
                <span class="oi oi-list-rich" aria-hidden="true"></span>
                Fetch data
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="main">
        <div class="top-row px-4">
          <a href="http://blazor.net" target="_blank" class="ml-md-auto">About</a>
        </div>
        <div class="content px-4">
          <h1>Hello, world!</h1>
          Welcome to your new app.
          <div class="alert alert-secondary mt-4" role="alert">
            <span class="oi oi-pencil mr-2" aria-hidden="true"></span>
            <strong>How is Blazor working for you?</strong>
            <span class="text-nowrap">
              Please take our
              <a target="_blank" class="font-weight-bold" href="https://go.microsoft.com/fwlink/?linkid=2127996">brief survey</a>
            </span>
            and tell us what you think.
          </div>
        </div>
      </div>
    </app>
    <div id="blazor-error-ui">
      An unhandled error has occurred.
      <a href="" class="reload">Reload</a>
      <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>var Module; window.__wasmmodulecallback__(); delete window.__wasmmodulecallback__;</script>
    <style>
          * { caret-color: transparent !important; }
          * > * { caret-color: transparent !important; }
          * > * > * { caret-color: transparent !important; }
          * > * > * > * { caret-color: transparent !important; }
          * > * > * > * > * { caret-color: transparent !important; }
    
    </style>
  </body>
</html>
```
<sup><a href='/src/Verify.Blazor.Tests/IntegrationTest/PlaywrightUsageTest.PageUsage.00.verified.html#L1-L78' title='Snippet source file'>snippet source</a> | <a href='#snippet-PlaywrightUsageTest.PageUsage.00.verified.html' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

[PlaywrightUsageTest.PageUsage.01.verified.png](/src/Verify.Blazor.Tests/IntegrationTest/PlaywrightUsageTest.PageUsage.01.verified.png):

<img src="/src/Verify.Blazor.Tests/IntegrationTest/PlaywrightUsageTest.PageUsage.01.verified.png" width="400px">


### Element results

<!-- snippet: PlaywrightUsageTest.ElementUsage.00.verified.html -->
<a id='snippet-PlaywrightUsageTest.ElementUsage.00.verified.html'></a>
```html
<h1>Hello, world!</h1>
Welcome to your new app.
<div class="alert alert-secondary mt-4" role="alert">
  <span class="oi oi-pencil mr-2" aria-hidden="true"></span>
  <strong>How is Blazor working for you?</strong>
  <span class="text-nowrap">
    Please take our
    <a target="_blank" class="font-weight-bold" href="https://go.microsoft.com/fwlink/?linkid=2127996">brief survey</a>
  </span>
  and tell us what you think.
</div>
```
<sup><a href='/src/Verify.Blazor.Tests/IntegrationTest/PlaywrightUsageTest.ElementUsage.00.verified.html#L1-L12' title='Snippet source file'>snippet source</a> | <a href='#snippet-PlaywrightUsageTest.ElementUsage.00.verified.html' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

[PlaywrightUsageTest.ElementUsage.01.verified.png](/src/Verify.Blazor.Tests/IntegrationTest/PlaywrightUsageTest.ElementUsage.01.verified.png):

<img src="/src/Verify.Blazor.Tests/IntegrationTest/PlaywrightUsageTest.ElementUsage.01.verified.png" width="400px">
