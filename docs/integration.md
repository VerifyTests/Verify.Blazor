<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/integration.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Integration testing using Verify.Selenium

[Verify.Selenium](https://github.com/VerifyTests/Verify.Selenium) extends [Verify](https://github.com/VerifyTests/Verify) to allow verification of Web UIs using [Selenium](https://www.selenium.dev/).


## Fixture for shared state

The running instance of the Blazor app and the Selenium driver are expensive to instantiate and should be share between tests. This sample uses xunit, so a [ClassFixture](https://xunit.net/docs/shared-context.html#class-fixture) is used to share state.

<!-- snippet: SeleniumFixture -->
<a id='snippet-seleniumfixture'/></a>
```cs
public class SeleniumFixture :
    IDisposable
{
    Process? process;
    ChromeDriver? driver;

    public SeleniumFixture()
    {
        // remove some noise from the html snapshot
        VerifierSettings.ScrubLinesContaining("<!--!-->");

        VerifySelenium.Enable();

        StartBlazorApp();

        StartDriver();

        WaitForRender();
    }

    void StartBlazorApp()
    {
        var baseDirectory = AppDomain.CurrentDomain.BaseDirectory!;
        var binPath = baseDirectory.Replace("Verify.Blazor.Tests", "BlazorApp");
        var projectDir = Path.GetFullPath(Path.Combine(binPath, "../../"));
        var startInfo = new ProcessStartInfo("dotnet", "run")
        {
            WorkingDirectory = projectDir
        };
        process = Process.Start(startInfo);
    }

    void StartDriver()
    {
        var options = new ChromeOptions();
        options.AddArgument("--no-sandbox");
        options.AddArgument("--headless");
        driver = new ChromeDriver(options);
        driver.Manage().Window.Size = new Size(1024, 768);
        driver.Navigate().GoToUrl("http://localhost:5000");
    }

    void WaitForRender()
    {
        var wait = new WebDriverWait(Driver, TimeSpan.FromSeconds(5));
        wait.Until(drv => drv.FindElement(By.ClassName("main")));
    }

    public ChromeDriver Driver => driver!;

    public void Dispose()
    {
        if (driver != null)
        {
            driver.Quit();
            driver.Dispose();
        }

        if (process != null)
        {
            process.Kill();
            process.Dispose();
        }
    }
}
```
<sup><a href='/src/Verify.Blazor.Tests/IntegrationTest/SeleniumFixture.cs#L10-L78' title='File snippet `seleniumfixture` was extracted from'>snippet source</a> | <a href='#snippet-seleniumfixture' title='Navigate to start of snippet `seleniumfixture`'>anchor</a></sup>
<!-- endsnippet -->


## Tests

<!-- snippet: SeleniumUsageTest -->
<a id='snippet-seleniumusagetest'/></a>
```cs
[UsesVerify]
public class SeleniumUsageTest :
    IClassFixture<SeleniumFixture>
{
    RemoteWebDriver driver;

    public SeleniumUsageTest(SeleniumFixture fixture)
    {
        driver = fixture.Driver;
    }

    [Fact]
    public async Task PageUsage()
    {
        await Verifier.Verify(driver);
    }

    [Fact]
    public async Task ElementUsage()
    {
        var element = driver.FindElement(By.ClassName("content"));
        await Verifier.Verify(element);
    }
}
```
<sup><a href='/src/Verify.Blazor.Tests/IntegrationTest/SeleniumUsageTest.cs#L8-L35' title='File snippet `seleniumusagetest` was extracted from'>snippet source</a> | <a href='#snippet-seleniumusagetest' title='Navigate to start of snippet `seleniumusagetest`'>anchor</a></sup>
<!-- endsnippet -->


### Page results

<!-- snippet: SeleniumUsageTest.PageUsage.00.verified.html -->
<a id='snippet-SeleniumUsageTest.PageUsage.00.verified.html'/></a>
```html
<html>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BlazorApp</title>
  <base href="/">
  <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link href="css/app.css" rel="stylesheet">
  <body>
    <app>
      <div class="sidebar">
        <div class="top-row pl-4 navbar navbar-dark">
          <a class="navbar-brand" href="">BlazorApp</a>
          <button class="navbar-toggler">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
        <div class="collapse">
          <ul class="nav flex-column">
            <li class="nav-item px-3">
              <a href="" class="nav-link active">
                <span class="oi oi-home" aria-hidden="true"></span>
                Home
              </a>
            </li>
            <li class="nav-item px-3">
              <a href="counter" class="nav-link">
                <span class="oi oi-plus" aria-hidden="true"></span>
                Counter
              </a>
            </li>
            <li class="nav-item px-3">
              <a href="fetchdata" class="nav-link">
                <span class="oi oi-list-rich" aria-hidden="true"></span>
                Fetch data
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="main">
        <div class="top-row px-4">
          <a href="http://blazor.net" target="_blank" class="ml-md-auto">About</a>
        </div>
        <div class="content px-4">
          <h1>Hello, world!</h1>
          Welcome to your new app.  
          <div class="alert alert-secondary mt-4" role="alert">
            <span class="oi oi-pencil mr-2" aria-hidden="true"></span>
            <strong>How is Blazor working for you?</strong>
            <span class="text-nowrap">
              Please take our
              <a target="_blank" class="font-weight-bold" href="https://go.microsoft.com/fwlink/?linkid=2127996">brief survey</a>
            </span>
            and tell us what you think.
          </div>
        </div>
      </div>
    </app>
    <div id="blazor-error-ui">
      An unhandled error has occurred.
      <a href="" class="reload">Reload</a>
      <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script type="text/javascript">var Module; window.__wasmmodulecallback__(); delete window.__wasmmodulecallback__;</script>
    <script src="_framework/wasm/dotnet.3.2.0.js" defer="" integrity="sha256-mPoqx7XczFHBWk3gRNn0hc9ekG1OvkKY4XiKRY5Mj5U=" crossorigin="anonymous"></script>
  </body>
</html>
```
<sup><a href='/src/Verify.Blazor.Tests/IntegrationTest/SeleniumUsageTest.PageUsage.00.verified.html#L1-L68' title='File snippet `SeleniumUsageTest.PageUsage.00.verified.html` was extracted from'>snippet source</a> | <a href='#snippet-SeleniumUsageTest.PageUsage.00.verified.html' title='Navigate to start of snippet `SeleniumUsageTest.PageUsage.00.verified.html`'>anchor</a></sup>
<!-- endsnippet -->

[TheTests.PageUsage.01.verified.png](/src/Verify.Blazor.Tests/IntegrationTest/SeleniumUsageTest.PageUsage.01.verified.png):

<img src="/src/Verify.Blazor.Tests/IntegrationTest/SeleniumUsageTest.PageUsage.01.verified.png" width="400px">


### Element results

<!-- snippet: SeleniumUsageTest.ElementUsage.00.verified.html -->
<a id='snippet-SeleniumUsageTest.ElementUsage.00.verified.html'/></a>
```html
<html>
  <body>
    <div class="content px-4">
      <h1>Hello, world!</h1>
      Welcome to your new app.  
      <div class="alert alert-secondary mt-4" role="alert">
        <span class="oi oi-pencil mr-2" aria-hidden="true"></span>
        <strong>How is Blazor working for you?</strong>
        <span class="text-nowrap">
          Please take our
          <a target="_blank" class="font-weight-bold" href="https://go.microsoft.com/fwlink/?linkid=2127996">brief survey</a>
        </span>
        and tell us what you think.
      </div>
    </div>
  </body>
</html>
```
<sup><a href='/src/Verify.Blazor.Tests/IntegrationTest/SeleniumUsageTest.ElementUsage.00.verified.html#L1-L17' title='File snippet `SeleniumUsageTest.ElementUsage.00.verified.html` was extracted from'>snippet source</a> | <a href='#snippet-SeleniumUsageTest.ElementUsage.00.verified.html' title='Navigate to start of snippet `SeleniumUsageTest.ElementUsage.00.verified.html`'>anchor</a></sup>
<!-- endsnippet -->

[TheTests.ElementUsage.01.verified.png](/src/Verify.Blazor.Tests/IntegrationTest/SeleniumUsageTest.ElementUsage.01.verified.png):

<img src="/src/Verify.Blazor.Tests/IntegrationTest/SeleniumUsageTest.ElementUsage.01.verified.png">
